---
layout:     post
title:      Quartz的使用
subtitle:   Quartz的使用
date:       2018-05-15
author:     longyi
header-img: img/post-bg-re-vs-ng2.jpg
catalog: true
tags:
    - java Quartz
    
---

>Quartz是企业级定时调度工具，开源任务调度框架，基于java来实现，官方网站http://www.quartz-scheduler.org/，spring默认的调度框架。

## 简介

特点：
1.提供持久化的job
2.灵活
3.分布式和集群能力

主要用到的设计模式：

    1.builder模式
    
    2.Factory模式
    
    3.组件模式
    
    4.链式写法

三个核心观念：

    1.调度器
    
    2.任务
    
    3.触发器


体系结构：

![](http://chuantu.biz/t6/311/1526396681x-1404781252.png)

由scheduler调用JobDetail任务

重要组成:

JOB JOBDetail JobBuilder JobStore

Trigger( simpleTrigger CronTrigger)
TriggerBuilder 
ThreadPool 

scheduler

Calender:一个trigger可以和多个calender关联

监听器：joblistener，triggerListen,SchedulerListener

### 谈谈job&JobDetail

job是个接口，只有一个方法execute

**生命周期**：每次调度器调用job时，它在调用execute之前会创建一个job的实例，当调用完成后，关联的job对象实例会被释放，释放的实例会被垃圾回收机制回收！

JobDetail为job实例提供了许多设置属性，以及jobDataMap成员变量属性，它用来存储特定Job实例的状态信息，调度器需要借助JobDetail对象来添加Job实例。

重要属性：

1.name 

2.Group 默认为DEFAULT 

3.jobClass 实现类 

4.jobDataMap

### JobExecutionContext 

当Scheduler调用job，会将JobExecutionContext传递给job的execute()方法；

job能通过JobExecutionContext对象访问到Quartz运行时候的环境以及Job本身的明细（可以通过JobDataMap传参）；

### 谈谈JobDataMap 

在进行任务调度时，JobDataMap存储在JobExecutionContext中，非常方便获取；

JobDataMap可以用来装载任何可序列化的数据对象，当job实例对象被执行时这些参数对象会传递给它

JobDataMap中实现了Jdk的Map接口，并且添加了一些非常方便的方法来存取基本数据类型。

context.getJobDetail().getJobDataMap()
context.getTrigger().getJobDataMap()

**可以直接通过context.getMergedDataMap(),若jobDetail的datamap和trigger中的datamap中有相同的key，则优先trigger。**

以上是通过Map方式获取，还有一种方式就是通过setter机制，在Job中设置中对应的变量（key），实例初始化的时候自动将key的value设置进去。

### Trigger

JobKey 表示Job的实例的标识，触发器被触发时，该指定的job实例会被执行；

StartTime：表示触发器的首次触发的时间，类型为java.util.Date。

EndTime：表示触发器不再被触发的时间。

#### simpleTrigger

在一个指定时间段内执行一次任务，或者是在指定时间间隔内多次执行作业任务；

定时定频率方面的应用都可以使用simpleTrigger

#### CronTrigger

基于**日历**的作业调度器，而不像simpleTrigger那样的定时定频的任务调度；

Cron表达式，类似于linux系统中的cron任务，用于配置CronTrigger实例。格式：【秒】【分】【小时】【日】【月】【周】【年】

    * * * * * ？ *  代表每秒钟

[![CyIpOe.md.png](https://s1.ax1x.com/2018/05/16/CyIpOe.md.png)](https://imgchr.com/i/CyIpOe)


[![CyIPwd.md.png](https://s1.ax1x.com/2018/05/16/CyIPwd.md.png)](https://imgchr.com/i/CyIPwd)

[![CyI3Yq.md.png](https://s1.ax1x.com/2018/05/16/CyI3Yq.md.png)](https://imgchr.com/i/CyI3Yq)

也可以通过一些工具“cron在线表达式工具”来满足需求！


## 第一个Quartz 的helloword实战

1.进入官网，到download页面，将maven的配置复制

2.新建maven项目





 


















